var apply,apply_none,apply_img,apply_any,apply_video,apply_link,apply_file_rename,apply_file_duplicate,apply_folder_rename;!function(a,e,t){"use strict";function n(e){C();var t=new Image;t.src=e,a(t).on("load",function(){j()})}function i(){a("#textfile_create_area").parent().parent().remove();var e=a("#lang_filename").val()+': <input type="text" id="create_text_file_name" style="min-height:30px"><br><hr><textarea id="textfile_create_area" style="width:100%;height:150px;"></textarea>';bootbox.dialog(e,[{label:a("#cancel").val(),"class":"btn"},{label:a("#ok").val(),"class":"btn-inverse",callback:function(){var e=a("#create_text_file_name").val(),t=a("#textfile_create_area").val();if(null!==e){e=y(e);var n=a("#sub_folder").val()+a("#fldr_value").val()+e,i=a("#cur_dir_thumb").val()+e;a.ajax({type:"POST",url:"execute.php?action=create_file",data:{path:n,path_thumb:i,name:e,new_content:t}}).done(function(e){""!=e&&bootbox.alert(e,function(){setTimeout(function(){window.location.href=a("#refresh").attr("href")+"&"+(new Date).getTime()},500)})})}}}],{header:a("#lang_new_file").val()})}function r(e){a("#textfile_edit_area").parent().parent().remove();var t=e.find(".rename-file").attr("data-thumb"),n=e.find(".rename-file").attr("data-path");a.ajax({type:"POST",url:"ajax_calls.php?action=get_file&sub_action=edit&preview_mode=text",data:{path:n}}).done(function(i){bootbox.dialog(i,[{label:a("#cancel").val(),"class":"btn"},{label:a("#ok").val(),"class":"btn-inverse",callback:function(){var e=a("#textfile_edit_area").val();a.ajax({type:"POST",url:"execute.php?action=save_text_file",data:{path:n,path_thumb:t,new_content:e}}).done(function(a){""!=a&&bootbox.alert(a)})}}],{header:e.find(".name_download").val()})})}function l(){a.ajax({type:"POST",url:"ajax_calls.php?action=get_lang",data:{}}).done(function(e){bootbox.dialog(e,[{label:a("#cancel").val(),"class":"btn"},{label:a("#ok").val(),"class":"btn-inverse",callback:function(){var e=a("#new_lang_select").val();a.ajax({type:"POST",url:"ajax_calls.php?action=change_lang",data:{choosen_lang:e}}).done(function(e){""!=e?bootbox.alert(e):setTimeout(function(){window.location.href=a("#refresh").attr("href")+"&"+(new Date).getTime()},500)})}}],{header:a("#lang_lang_change").val()})})}function o(e){a("#files_permission_start").parent().parent().remove();var t,n;e.hasClass("directory")?(t=e.find(".rename-folder").attr("data-thumb"),n=e.find(".rename-folder").attr("data-path")):(t=e.find(".rename-file").attr("data-thumb"),n=e.find(".rename-file").attr("data-path")),a.ajax({type:"POST",url:"ajax_calls.php?action=chmod",data:{path:n,path_thumb:t}}).done(function(e){bootbox.dialog(e,[{label:a("#cancel").val(),"class":"btn"},{label:a("#ok").val(),"class":"btn-inverse",callback:function(){var e=a("#chmod_form #chmod_value").val();if(""!=e&&"undefined"!=typeof e){var i=a("#chmod_form input[name=apply_recursive]:checked").val();(""==i||"undefined"==typeof i)&&(i="none"),a.ajax({type:"POST",url:"execute.php?action=chmod",data:{path:n,path_thumb:t,new_mode:e,is_recursive:i}}).done(function(a){""!=a&&bootbox.alert(a)})}}}],{header:a("#lang_file_permission").val()})})}function c(e){var t=[];if(t.user=0,t.group=0,t.all=0,"undefined"!=typeof e&&1==e){var n=a("#chmod_form #chmod_value").val();t.user=n.substr(0,1),t.group=n.substr(1,1),t.all=n.substr(2,1),a.each(t,function(e){(""==t[e]||0==a.isNumeric(t[e])||parseInt(t[e])<0||parseInt(t[e])>7)&&(t[e]="0")}),a("#chmod_form input:checkbox").each(function(){var e=a(this).attr("data-group"),n=a(this).attr("data-value");d(t[e],n)?a(this).prop("checked",!0):a(this).prop("checked",!1)})}else a("#chmod_form input:checkbox:checked").each(function(){var e=a(this).attr("data-group"),n=a(this).attr("data-value");t[e]=parseInt(t[e])+parseInt(n)}),a("#chmod_form #chmod_value").val(t.user.toString()+t.group.toString()+t.all.toString())}function d(e,t){var n=[];return n[1]=[1,3,5,7],n[2]=[2,3,6,7],n[4]=[4,5,6,7],e=parseInt(e),t=parseInt(t),-1!=a.inArray(e,n[t])}function s(){bootbox.confirm(a("#lang_clear_clipboard_confirm").val(),a("#cancel").val(),a("#ok").val(),function(e){1==e&&a.ajax({type:"POST",url:"ajax_calls.php?action=clear_clipboard",data:{}}).done(function(e){""!=e?bootbox.alert(e):a("#clipboard").val("0"),m(!1)})})}function p(e,t){if("copy"==t||"cut"==t){var n,i;e.hasClass("directory")?(n=e.find(".rename-folder").attr("data-thumb"),i=e.find(".rename-folder").attr("data-path")):(n=e.find(".rename-file").attr("data-thumb"),i=e.find(".rename-file").attr("data-path")),a.ajax({type:"POST",url:"ajax_calls.php?action=copy_cut",data:{path:i,path_thumb:n,sub_action:t}}).done(function(e){""!=e?bootbox.alert(e):(a("#clipboard").val("1"),m(!0))})}}function f(e){bootbox.confirm(a("#lang_paste_confirm").val(),a("#cancel").val(),a("#ok").val(),function(t){if(1==t){var n,i;"undefined"!=typeof e?(n=e.find(".rename-folder").attr("data-path"),i=e.find(".rename-folder").attr("data-thumb")):(n=a("#sub_folder").val()+a("#fldr_value").val(),i=a("#cur_dir_thumb").val()),a.ajax({type:"POST",url:"execute.php?action=paste_clipboard",data:{path:n,path_thumb:i}}).done(function(e){""!=e?bootbox.alert(e):(a("#clipboard").val("0"),m(!1),setTimeout(function(){window.location.href=a("#refresh").attr("href")+"&"+(new Date).getTime()},300))})}})}function u(e,t){var n;n=e.find(e.hasClass("directory")?".rename-folder":".rename-file");var i=n.attr("data-thumb"),r=n.attr("data-path");e.parent().hide(100),a.ajax({type:"POST",url:"ajax_calls.php?action=copy_cut",data:{path:r,path_thumb:i,sub_action:"cut"}}).done(function(n){if(""!=n)bootbox.alert(n);else{var i,r;"undefined"!=typeof t?t.hasClass("back-directory")?(i=t.find(".path").val(),r=t.find(".path_thumb").val()):(i=t.find(".rename-folder").attr("data-path"),r=t.find(".rename-folder").attr("data-thumb")):(i=a("#sub_folder").val()+a("#fldr_value").val(),r=a("#cur_dir_thumb").val()),a.ajax({type:"POST",url:"execute.php?action=paste_clipboard",data:{path:i,path_thumb:r}}).done(function(t){""!=t?(bootbox.alert(t),e.parent().show(100)):(a("#clipboard").val("0"),m(!1),e.parent().remove())})}}).error(function(){e.parent().show(100)})}function m(e){1==e?a(".paste-here-btn, .clear-clipboard-btn").removeClass("disabled"):a(".paste-here-btn, .clear-clipboard-btn").addClass("disabled")}function v(t){var n=a(".breadcrumb").width()+t,i=a("#view"),r=a("#help");if(a(".uploader").css("width",n),i.val()>0){if(1==i.val())a("ul.grid li, ul.grid figure").css("width","100%");else{var l=Math.floor(n/380);0==l&&(l=1,a("h4").css("font-size",12)),n=Math.floor(n/l-3),a("ul.grid li, ul.grid figure").css("width",n)}r.hide()}else e.touch&&r.show()}function h(){var e=a(this);0==a("#view").val()&&(1==e.attr("toggle")?(e.attr("toggle",0),e.animate({top:"0px"},{queue:!1,duration:300})):(e.attr("toggle",1),e.animate({top:"-30px"},{queue:!1,duration:300})))}function b(a){for(var e=a.split("/"),t=3;t<e.length;t++)e[t]=encodeURIComponent(e[t]);return e.join("/")}function _(a){var e=new RegExp("(?:[?&]|&)"+a+"=([^&]+)","i"),t=window.location.search.match(e);return t&&t.length>1?t[1]:null}function g(){1==a("#popup").val()?window.close():"undefined"!=typeof parent.jQuery&&parent.jQuery?parent.jQuery.fancybox.close():parent.$.fancybox.close()}function w(a){for(var a,e=[/[\300-\306]/g,/[\340-\346]/g,/[\310-\313]/g,/[\350-\353]/g,/[\314-\317]/g,/[\354-\357]/g,/[\322-\330]/g,/[\362-\370]/g,/[\331-\334]/g,/[\371-\374]/g,/[\321]/g,/[\361]/g,/[\307]/g,/[\347]/g],t=["A","a","E","e","I","i","O","o","U","u","N","n","C","c"],n=0;n<e.length;n++)a=a.replace(e[n],t[n]);return a}function y(e){return null!=e?("true"==a("#transliteration").val()&&(e=w(e),e=e.replace(/[^A-Za-z0-9\.\-\[\] _]+/g,"")),"true"==a("#convert_spaces").val()&&(e=e.replace(/ /g,a("#replace_with").val()),e=e.toLowerCase()),e=e.replace('"',""),e=e.replace("'",""),e=e.replace("/",""),e=e.replace("\\",""),e=e.replace(/<\/?[^>]+(>|$)/g,""),a.trim(e)):null}function x(e,t,n,i,r,l){null!==i&&(i=y(i),a.ajax({type:"POST",url:"execute.php?action="+e,data:{path:t,path_thumb:n,name:i.replace("/","")}}).done(function(a){return""!=a?(bootbox.alert(a),!1):(""!=l&&window[l](r,i),!0)}))}function k(e,t){var n=a("li.dir","ul.grid").filter(":visible"),i=a("li.file","ul.grid").filter(":visible"),r=[],l=[],o=[],c=[];n.each(function(){var e=a(this),n=e.find(t).val();if(a.isNumeric(n))for(n=parseFloat(n);"undefined"!=typeof r[n]&&r[n];)n=parseFloat(parseFloat(n)+parseFloat(.001));else n=n+"a"+e.find("h4 a").attr("data-file");r[n]=e.html(),l.push(n)}),i.each(function(){var e=a(this),n=e.find(t).val();if(a.isNumeric(n))for(n=parseFloat(n);"undefined"!=typeof o[n]&&o[n];)n=parseFloat(parseFloat(n)+parseFloat(.001));else n=n+"a"+e.find("h4 a").attr("data-file");o[n]=e.html(),c.push(n)}),a.isNumeric(l[0])?l.sort(function(a,e){return parseFloat(a)-parseFloat(e)}):l.sort(),a.isNumeric(c[0])?c.sort(function(a,e){return parseFloat(a)-parseFloat(e)}):c.sort(),e&&(l.reverse(),c.reverse()),n.each(function(e){var t=a(this);t.html(r[l[e]])}),i.each(function(e){var t=a(this);t.html(o[c[e]])})}function C(){a("#loading_container").css("display","block"),a("#loading").css("opacity",".7")}function j(){a("#loading_container").fadeOut()}function T(a,e){return featherEditor.launch({image:a,url:e}),!1}function I(){a(".lazy-loaded").lazyload()}var O="9.9.0",S=!0,M=0,E=function(){var a=0;return function(e,t){clearTimeout(a),a=setTimeout(e,t)}}(),F={contextActions:{copy_url:function(e){var t=a("#base_url").val()+a("#cur_dir").val(),n=e.find("a.link").attr("data-file");""!=n&&null!=n&&(t+=n),n=e.find("h4 a.folder-link").attr("data-file"),""!=n&&null!=n&&(t+=n),bootbox.alert('URL:<br/><div class="input-append" style="width:100%"><input id="url_text'+M+'" type="text" style="width:80%; height:30px;" value="'+b(t)+'" /><button id="copy-button'+M+'" class="btn btn-inverse copy-button" style="width:20%; height:30px;" data-clipboard-target="url_text'+M+'" data-clipboard-text="Copy Me!" title="copy"></button></div>'),a("#copy-button"+M).html('<i class="icon icon-white icon-share"></i> '+a("#lang_copy").val());var i=new ZeroClipboard(a("#copy-button"+M));i.on("ready",function(){i.on("wrongFlash noFlash",function(){ZeroClipboard.destroy()}),i.on("aftercopy",function(){a("#copy-button"+M).html('<i class="icon icon-ok"></i> '+a("#ok").val()),a("#copy-button"+M).attr("class","btn disabled"),M++}),i.on("error",function(){})})},unzip:function(e){var t=a("#sub_folder").val()+a("#fldr_value").val()+e.find("a.link").attr("data-file");a.ajax({type:"POST",url:"ajax_calls.php?action=extract",data:{path:t}}).done(function(e){""!=e?bootbox.alert(e):window.location.href=a("#refresh").attr("href")+"&"+(new Date).getTime()})},edit_img:function(e){var t=e.attr("data-name"),n=a("#base_url_true").val()+a("#cur_dir").val()+t,i=a("#aviary_img");i.attr("data-name",t),i.attr("src",n).load(T(i.attr("id"),n))},duplicate:function(e){var t=e.find("h4").text().trim();bootbox.prompt(a("#lang_duplicate").val(),a("#cancel").val(),a("#ok").val(),function(a){if(null!==a&&(a=y(a),a!=t)){var n=e.find(".rename-file");x("duplicate_file",n.attr("data-path"),n.attr("data-thumb"),a,n,"apply_file_duplicate")}},t)},copy:function(a){p(a,"copy")},cut:function(a){p(a,"cut")},paste:function(){f()},chmod:function(a){o(a)},edit_text_file:function(a){r(a)}},makeContextMenu:function(){var e=this;a.contextMenu({selector:"figure:not(.back-directory), .list-view2 figure:not(.back-directory)",autoHide:!0,build:function(n){n.addClass("selected");var i={callback:function(a){e.contextActions[a](n)},items:{}};return(n.find(".img-precontainer-mini .filetype").hasClass("png")||n.find(".img-precontainer-mini .filetype").hasClass("jpg")||n.find(".img-precontainer-mini .filetype").hasClass("jpeg"))&&t&&(i.items.edit_img={name:a("#lang_edit_image").val(),icon:"edit_img",disabled:!1}),i.items.copy_url={name:a("#lang_show_url").val(),icon:"url",disabled:!1},(n.find(".img-precontainer-mini .filetype").hasClass("zip")||n.find(".img-precontainer-mini .filetype").hasClass("tar")||n.find(".img-precontainer-mini .filetype").hasClass("gz"))&&(i.items.unzip={name:a("#lang_extract").val(),icon:"extract",disabled:!1}),n.find(".img-precontainer-mini .filetype").hasClass("edit-text-file-allowed")&&(i.items.edit_text_file={name:a("#lang_edit_file").val(),icon:"edit",disabled:!1}),n.hasClass("directory")||1!=a("#duplicate").val()||(i.items.duplicate={name:a("#lang_duplicate").val(),icon:"duplicate",disabled:!1}),n.hasClass("directory")||1!=a("#copy_cut_files_allowed").val()?n.hasClass("directory")&&1==a("#copy_cut_dirs_allowed").val()&&(i.items.copy={name:a("#lang_copy").val(),icon:"copy",disabled:!1},i.items.cut={name:a("#lang_cut").val(),icon:"cut",disabled:!1}):(i.items.copy={name:a("#lang_copy").val(),icon:"copy",disabled:!1},i.items.cut={name:a("#lang_cut").val(),icon:"cut",disabled:!1}),0==a("#clipboard").val()||n.hasClass("directory")||(i.items.paste={name:a("#lang_paste_here").val(),icon:"clipboard-apply",disabled:!1}),n.hasClass("directory")||1!=a("#chmod_files_allowed").val()?n.hasClass("directory")&&1==a("#chmod_dirs_allowed").val()&&(i.items.chmod={name:a("#lang_file_permission").val(),icon:"key",disabled:!1}):i.items.chmod={name:a("#lang_file_permission").val(),icon:"key",disabled:!1},i.items.sep="----",i.items.info={name:"<strong>"+a("#lang_file_info").val()+"</strong>",disabled:!0},i.items.name={name:n.attr("data-name"),icon:"label",disabled:!0},"img"==n.attr("data-type")&&(i.items.dimension={name:n.find(".img-dimension").html(),icon:"dimension",disabled:!0}),i.items.size={name:n.find(".file-size").html(),icon:"size",disabled:!0},i.items.date={name:n.find(".file-date").html(),icon:"date",disabled:!0},i},events:{hide:function(){a("figure").removeClass("selected")}}}),a(document).on("contextmenu",function(e){return a(e.target).is("figure")?void 0:!1})},bindGridEvents:function(){function e(a){window[a.attr("data-function")](a.attr("data-file"),a.attr("data-field_id"))}var t=a("ul.grid");t.on("click",".modalAV",function(e){var t=a(this);e.preventDefault();var n=a("#previewAV"),i=a(".body-preview");n.removeData("modal"),n.modal({backdrop:"static",keyboard:!1}),t.hasClass("audio")?i.css("height","80px"):i.css("height","345px"),a.ajax({url:t.attr("data-url"),success:function(a){i.html(a)}})}),t.on("click",".file-preview-btn",function(e){var t=a(this);e.preventDefault(),a.ajax({url:t.attr("data-url"),success:function(a){bootbox.alert(a)}})}),t.on("click",".preview",function(){var e=a(this);return a("#full-img").attr("src",decodeURIComponent(e.attr("data-url"))),!0}),t.on("click",".rename-file",function(){var e=a(this),t=e.parent().parent().parent(),n=t.find("h4"),i=a.trim(n.text());bootbox.prompt(a("#rename").val(),a("#cancel").val(),a("#ok").val(),function(a){null!==a&&(a=y(a),a!=i&&x("rename_file",e.attr("data-path"),e.attr("data-thumb"),a,t,"apply_file_rename"))},i)}),t.on("click",".rename-folder",function(){var e=a(this),t=e.parent().parent().parent(),n=t.find("h4"),i=a.trim(n.text());bootbox.prompt(a("#rename").val(),a("#cancel").val(),a("#ok").val(),function(a){null!==a&&(a=y(a).replace(".",""),a!=i&&x("rename_folder",e.attr("data-path"),e.attr("data-thumb"),a,t,"apply_folder_rename"))},i)}),t.on("click",".delete-file",function(){var e=a(this);bootbox.confirm(e.attr("data-confirm"),a("#cancel").val(),a("#ok").val(),function(a){1==a&&(x("delete_file",e.attr("data-path"),e.attr("data-thumb"),"","",""),e.parent().parent().parent().parent().remove())})}),t.on("click",".delete-folder",function(){var e=a(this);bootbox.confirm(e.attr("data-confirm"),a("#cancel").val(),a("#ok").val(),function(a){1==a&&(x("delete_folder",e.attr("data-path"),e.attr("data-thumb"),"","",""),e.parent().parent().parent().remove())})}),a("ul.grid").on("click",".link",function(){e(a(this))}),a("ul.grid").on("click","div.box",function(){var t=a(this).find(".link");if(0!==t.length)e(t);else{var n=a(this).find(".folder-link");0!==n.length&&(document.location=a(n).prop("href"))}})},makeFilters:function(e){a("#filter-input").on("keyup",function(){a(".filters label").removeClass("btn-inverse"),a(".filters label").find("i").removeClass("icon-white"),a("#ff-item-type-all").addClass("btn-inverse"),a("#ff-item-type-all").find("i").addClass("icon-white");var t=y(a(this).val()).toLowerCase();a(this).val(t),e&&E(function(){a("li","ul.grid ").each(function(){var e=a(this);""!=t&&-1==e.attr("data-name").toLowerCase().indexOf(t)?e.hide(100):e.show(100)}),I(),a.ajax({url:"ajax_calls.php?action=filter&type="+t}).done(function(a){""!=a&&bootbox.alert(a)}),E(function(){var e=0!=a("#descending").val()?!0:!1;k(e,"."+a("#sort_by").val())},500)},300)}).keypress(function(e){13==e.which&&a("#filter").trigger("click")}),a("#filter").on("click",function(){var e=y(a("#filter-input").val());window.location.href=a("#current_url").val()+"&filter="+e})},makeUploader:function(){a("#uploader-btn").on("click",function(){var e=a("#sub_folder").val()+a("#fldr_value").val()+"/";e=e.substring(0,e.length-1),a("#iframe-container").html(a("<iframe />",{name:"JUpload",id:"uploader_frame",src:"uploader/index.php?path="+e,frameborder:0,width:"100%",height:360}))}),a(".upload-btn").on("click",function(){a(".uploader").show(500)}),a(".close-uploader").on("click",function(){a(".uploader").hide(500),setTimeout(function(){window.location.href=a("#refresh").attr("href")+"&"+(new Date).getTime()},420)})},makeSort:function(e){a("input[name=radio-sort]").on("click",function(){var n=a(this).attr("data-item"),i=a("#"+n),r=a(".filters label");r.removeClass("btn-inverse"),r.find("i").removeClass("icon-white"),a("#filter-input").val(""),i.addClass("btn-inverse"),i.find("i").addClass("icon-white"),"ff-item-type-all"==n?e?a(".grid li").show(300):window.location.href=a("#current_url").val()+"&sort_by="+a("#sort_by").val()+"&descending="+(t?1:0):a(this).is(":checked")&&(a(".grid li").not("."+n).hide(300),a(".grid li."+n).show(300)),I()});var t=a("#descending").val();a(".sorter").on("click",function(){var n=a(this);t=a("#sort_by").val()===n.attr("data-sort")?0==t?!0:!1:!0,e?(a.ajax({url:"ajax_calls.php?action=sort&sort_by="+n.attr("data-sort")+"&descending="+(t?1:0)}),k(t,"."+n.attr("data-sort")),a(" a.sorter").removeClass("descending").removeClass("ascending"),a(".sort-"+n.attr("data-sort")).addClass(t?"descending":"ascending"),a("#sort_by").val(n.attr("data-sort")),a("#descending").val(t?1:0),I()):window.location.href=a("#current_url").val()+"&sort_by="+n.attr("data-sort")+"&descending="+(t?1:0)})}};a(document).ready(function(){if(S&&F.makeContextMenu(),a("#full-img").on("click",function(){a("#previewLightbox").lightbox("hide")}),F.bindGridEvents(),parseInt(a("#file_number").val())>parseInt(a("#file_number_limit_js").val()))var t=!1;else var t=!0;if(F.makeSort(t),F.makeFilters(t),a("#info").on("click",function(){bootbox.alert('<div class="text-center"><br/><img src="img/logo.png" alt="responsive filemanager"/><br/><br/><p><strong>RESPONSIVE filemanager v.'+O+'</strong><br/><a href="http://www.responsivefilemanager.com">responsivefilemanager.com</a></p><br/><p>Copyright © <a href="http://www.tecrail.com" alt="tecrail">Tecrail</a> - Alberto Peripolli. All rights reserved.</p><br/><p>License<br/><small><img alt="Creative Commons License" style="border-width:0" src="http://responsivefilemanager.com/license.php" /><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</small></p></div>')}),a("#change_lang_btn").on("click",function(){l()}),F.makeUploader(),a("body").on("keypress",function(a){var e=String.fromCharCode(a.which);return"'"==e||'"'==e||"\\"==e||"/"==e?!1:void 0}),a("ul.grid li figcaption").on("click",'a[data-toggle="lightbox"]',function(){n(decodeURIComponent(a(this).attr("data-url")))}),a(".create-file-btn").on("click",function(){i()}),a(".new-folder").on("click",function(){bootbox.prompt(a("#insert_folder_name").val(),a("#cancel").val(),a("#ok").val(),function(e){if(null!==e){e=y(e).replace(".","");var t=a("#sub_folder").val()+a("#fldr_value").val()+e,n=a("#cur_dir_thumb").val()+e;a.ajax({type:"POST",url:"execute.php?action=create_folder",data:{path:t,path_thumb:n}}).done(function(){setTimeout(function(){window.location.href=a("#refresh").attr("href")+"&"+(new Date).getTime()},300)})}},a("#new_folder").val())}),a(".view-controller button").on("click",function(){var e=a(this);a(".view-controller button").removeClass("btn-inverse"),a(".view-controller i").removeClass("icon-white"),e.addClass("btn-inverse"),e.find("i").addClass("icon-white"),a.ajax({url:"ajax_calls.php?action=view&type="+e.attr("data-value")}).done(function(a){""!=a&&bootbox.alert(a)}),"undefined"!=typeof a("ul.grid")[0]&&a("ul.grid")[0]&&(a("ul.grid")[0].className=a("ul.grid")[0].className.replace(/\blist-view.*?\b/g,"")),"undefined"!=typeof a(".sorter-container")[0]&&a(".sorter-container")[0]&&(a(".sorter-container")[0].className=a(".sorter-container")[0].className.replace(/\blist-view.*?\b/g,""));var t=e.attr("data-value");a("#view").val(t),a("ul.grid").addClass("list-view"+t),a(".sorter-container").addClass("list-view"+t),e.attr("data-value")>=1?v(14):(a("ul.grid li").css("width",126),a("ul.grid figure").css("width",122)),I()}),e.touch?(a("#help").show(),a(".box:not(.no-effect)").swipe({swipeLeft:h,swipeRight:h,threshold:30})):(a(".tip").tooltip({placement:"bottom"}),a(".tip-top").tooltip({placement:"top"}),a(".tip-left").tooltip({placement:"left"}),a(".tip-right").tooltip({placement:"right"}),a("body").addClass("no-touch")),a(".paste-here-btn").on("click",function(){0==a(this).hasClass("disabled")&&f()}),a(".clear-clipboard-btn").on("click",function(){0==a(this).hasClass("disabled")&&s()}),!e.csstransforms){var r=a("figure");r.on("mouseover",function(){0==a("#view").val()&&a("#main-item-container").hasClass("no-effect-slide")===!1&&a(this).find(".box:not(.no-effect)").animate({top:"-26px"},{queue:!1,duration:300})}),r.on("mouseout",function(){0==a("#view").val()&&a(this).find(".box:not(.no-effect)").animate({top:"0px"},{queue:!1,duration:300})})}a(window).resize(function(){v(28)}),v(14),m(1==a("#clipboard").val()?!0:!1),a("li.dir, li.file").draggable({distance:20,cursor:"move",helper:function(){a(this).find("figure").find(".box").css("top","0px");var e=a(this).clone().css("z-index",1e3).find(".box").css("box-shadow","none").css("-webkit-box-shadow","none").parent().parent();return a(this).addClass("selected"),e},start:function(){0==a("#view").val()&&a("#main-item-container").addClass("no-effect-slide")},stop:function(){a(this).removeClass("selected"),0==a("#view").val()&&a("#main-item-container").removeClass("no-effect-slide")}}),a("li.dir,li.back").droppable({accept:"ul.grid li",activeClass:"ui-state-highlight",hoverClass:"ui-state-hover",drop:function(e,t){u(t.draggable.find("figure"),a(this).find("figure"))}}),a(document).on("keyup","#chmod_form #chmod_value",function(){c(!0)}),a(document).on("focusout","#chmod_form #chmod_value",function(){var e=a("#chmod_form #chmod_value");null==e.val().match(/^[0-7]{3}$/)&&(e.val(e.attr("data-def-value")),c(!0))})}),apply=function(e,t){var n;n=1==a("#popup").val()?window.opener:window.parent;var i=a("#cur_dir").val(),r=a("#subdir").val(),l=a("#base_url").val(),o=e.substr(0,e.lastIndexOf(".")),c=e.split(".").pop();c=c.toLowerCase();var d="",s=["ogg","mp3","wav"],p=["mp4","ogg","webm"],f=a("#return_relative_url").val(),u=b((1==f?r:l+i)+e);if(""!=t)if(1==a("#crossdomain").val())n.postMessage({sender:"responsivefilemanager",url:u,field_id:t},"*");else{var m=a("#"+t,n.document);m.val(u).trigger("change"),"function"==typeof n.responsive_filemanager_callback&&n.responsive_filemanager_callback(t),g()}else a.inArray(c,ext_img)>-1?d='<img src="'+u+'" alt="'+o+'" />':a.inArray(c,p)>-1?d='<video controls source src="'+u+'" type="video/'+c+'">'+o+"</video>":a.inArray(c,s)>-1?("mp3"==c&&(c="mpeg"),d='<audio controls src="'+u+'" type="audio/'+c+'">'+o+"</audio>"):d='<a href="'+u+'" title="'+o+'">'+o+"</a>",1==a("#crossdomain").val()?n.postMessage({sender:"responsivefilemanager",url:u,field_id:null,html:d},"*"):parent.tinymce.majorVersion<4?(parent.tinymce.activeEditor.execCommand("mceInsertContent",!1,d),parent.tinymce.activeEditor.windowManager.close(parent.tinymce.activeEditor.windowManager.params.mce_window_id)):(parent.tinymce.activeEditor.insertContent(d),parent.tinymce.activeEditor.windowManager.close())},apply_link=function(e,t){if(1==a("#popup").val())var n=window.opener;else var n=window.parent;var i=a("#cur_dir").val();i=i.replace("\\","/");var r=a("#subdir").val();r=r.replace("\\","/");var l=a("#base_url").val(),o=a("#return_relative_url").val(),c=b((1==o?r:l+i)+e);if(""!=t)if(1==a("#crossdomain").val())n.postMessage({sender:"responsivefilemanager",url:c,field_id:t},"*");else{var d=a("#"+t,n.document);d.val(c).trigger("change"),"function"==typeof n.responsive_filemanager_callback&&n.responsive_filemanager_callback(t),g()}else apply_any(c)},apply_img=function(e,t){var n;n=1==a("#popup").val()?window.opener:window.parent;var i=a("#cur_dir").val();i=i.replace("\\","/");var r=a("#subdir").val();r=r.replace("\\","/");var l=a("#base_url").val(),o=a("#return_relative_url").val(),c=b((1==o?r:l+i)+e);if(""!=t)if(1==a("#crossdomain").val())n.postMessage({sender:"responsivefilemanager",url:c,field_id:t},"*");else{var d=a("#"+t,n.document);d.val(c).trigger("change"),"function"==typeof n.responsive_filemanager_callback&&n.responsive_filemanager_callback(t),g()}else apply_any(c)},apply_video=function(e,t){var n;n=1==a("#popup").val()?window.opener:window.parent;var i=a("#cur_dir").val();i=i.replace("\\","/");var r=a("#subdir").val();r=r.replace("\\","/");var l=a("#base_url").val(),o=a("#return_relative_url").val(),c=b((1==o?r:l+i)+e);if(""!=t)if(1==a("#crossdomain").val())n.postMessage({sender:"responsivefilemanager",url:c,field_id:t},"*");else{var d=a("#"+t,n.document);d.val(c).trigger("change"),"function"==typeof n.responsive_filemanager_callback&&n.responsive_filemanager_callback(t),g()}else apply_any(c)},apply_none=function(e){var t=a('li[data-name="'+e+'"]').find(".preview");if(""!=t.html()&&void 0!==t.html()){if(0==t.hasClass("disabled")){var i=decodeURIComponent(t.attr("data-url"));a("#full-img").attr("src",i),n(i),a("#previewLightbox").lightbox("show")}}else{var t=a('li[data-name="'+e+'"]').find("a.file-preview-btn");if(""!=t.html()&&void 0!==t.html())a.ajax({url:t.attr("data-url"),success:function(a){bootbox.alert(a)}});else{var t=a('li[data-name="'+e+'"]').find(".modalAV"),r=a("#previewAV"),l=a(".body-preview");r.removeData("modal"),r.modal({backdrop:"static",keyboard:!1}),t.hasClass("audio")?l.css("height","80px"):l.css("height","345px"),a.ajax({url:decodeURIComponent(t.attr("data-url")),success:function(a){l.html(a)}})}}},apply_any=function(e){if(1==a("#crossdomain").val())window.parent.postMessage({sender:"responsivefilemanager",url:e,field_id:null},"*");else{var t=a("#editor").val();if("ckeditor"==t){var n=_("CKEditorFuncNum");window.opener.CKEDITOR.tools.callFunction(n,e),window.close()}else parent.tinymce.majorVersion<4?(parent.tinymce.activeEditor.windowManager.params.setUrl(e),parent.tinymce.activeEditor.windowManager.close(parent.tinymce.activeEditor.windowManager.params.mce_window_id)):(parent.tinymce.activeEditor.windowManager.getParams().setUrl(e),parent.tinymce.activeEditor.windowManager.close())}},apply_file_duplicate=function(a,e){var t=a.parent().parent().parent().parent();t.after("<li class='"+t.attr("class")+"' data-name='"+t.attr("data-name")+"'>"+t.html()+"</li>");var n=t.next();apply_file_rename(n.find("figure"),e);var i=n.find(".download-form"),r="form"+(new Date).getTime();i.attr("id",r),i.find(".tip-right").attr("onclick","$('#"+r+"').submit();")},apply_file_rename=function(e,t){var n;e.attr("data-name",t),e.parent().attr("data-name",t),e.find("h4").find("a").text(t);var i=e.find("a.link");n=i.attr("data-file");var r=n.substring(n.lastIndexOf("/")+1),l=n.substring(n.lastIndexOf(".")+1);i.each(function(){a(this).attr("data-file",encodeURIComponent(t+"."+l))}),e.find("img").each(function(){var e=a(this).attr("src");a(this).attr("src",e.replace(r,t+"."+l)+"?time="+(new Date).getTime()),a(this).attr("alt",t+" thumbnails")});var o=e.find("a.preview");n=o.attr("data-url"),"undefined"!=typeof n&&n&&o.attr("data-url",n.replace(encodeURIComponent(r),encodeURIComponent(t+"."+l))),e.parent().attr("data-name",t+"."+l),e.attr("data-name",t+"."+l),e.find(".name_download").val(t+"."+l);var c=e.find("a.rename-file"),d=e.find("a.delete-file"),s=c.attr("data-path"),p=c.attr("data-thumb"),f=s.replace(r,t+"."+l),u=p.replace(r,t+"."+l);c.attr("data-path",f),c.attr("data-thumb",u),d.attr("data-path",f),d.attr("data-thumb",u)},apply_folder_rename=function(e,t){e.attr("data-name",t),e.find("figure").attr("data-name",t);var n=e.find("h4").find("a").text();e.find("h4 > a").text(t);var i=e.find(".folder-link"),r=i.attr("href"),l=a("#fldr_value").val(),o=r.replace("fldr="+l+encodeURIComponent(n),"fldr="+l+encodeURIComponent(t));i.each(function(){a(this).attr("href",o)});var c=e.find("a.delete-folder"),d=e.find("a.rename-folder"),s=d.attr("data-path"),p=d.attr("data-thumb"),f=s.lastIndexOf("/"),u=s.substr(0,f+1)+t;c.attr("data-path",u),d.attr("data-path",u);var f=p.lastIndexOf("/"),u=p.substr(0,f+1)+t;c.attr("data-thumb",u),d.attr("data-thumb",u)}}(jQuery,Modernizr,image_editor);